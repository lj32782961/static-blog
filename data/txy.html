<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Long Press to Select Text</title>
<style>
  #text {
    width: 100%;
    height: 100px;
    border: 1px solid #ccc;
    padding: 10px;
    white-space: pre-wrap;
  }
  #contextMenu {
    position: absolute;
    background-color: #fff;
    border: 1px solid #ccc;
    padding: 10px;
    display: none; /* Initially hidden */
  }
</style>
</head>
<body>

<div id="text" tabindex="0">
  这里是一段示例文本，您可以尝试长按来选择我。
</div>
<div id="contextMenu">
  <button onclick="copySelectedText()">复制</button>
</div>

<script>
  let timer;
  let selectionTimer;
  const textElement = document.getElementById('text');
  const contextMenu = document.getElementById('contextMenu');
  document.addEventListener('contextmenu', (e) => e.preventDefault());
  textElement.addEventListener('touchstart', function(event) {
    selectionTimer = setTimeout(() => {
      // 长按触发，启动文本选择  (不做任何选择，交给用户)
      textElement.focus(); //  这行代码很重要，确保文本区域获得焦点
    }, 500);
  });

  textElement.addEventListener('touchend', function(event) {
    clearTimeout(selectionTimer);
    selectionTimer = setTimeout(showContextMenu, 2000); // 2秒后检查是否选择了文本
  });

  function showContextMenu() {
    const selection = window.getSelection();
    if (!selection.isCollapsed) { // Only show if text is selected
      const range = selection.getRangeAt(0);
      const rect = range.getBoundingClientRect();
      contextMenu.style.left = rect.left + 'px';
      contextMenu.style.top = rect.bottom + 'px';
      contextMenu.style.display = 'block';
    }
  }


  function copySelectedText() {
    const selectedText = window.getSelection().toString();
    navigator.clipboard.writeText(selectedText).then(() => {
      alert('已复制');
      contextMenu.style.display = 'none';
    }).catch(err => {
      alert('复制失败');
      contextMenu.style.display = 'none';
    });
  }
</script>

</body>
</html>